用 **两张流程图**：

1. **总流程图**：从宏观数据 → Execution → Explanation
2. **策略池筛选器放大图**：清晰对比

   * 「规则选策略（Rule-based Router）」
   * 「LLM 直接选策略（LLM Router）」

并且**每个节点都明确标注：量化引擎 / LLM / 人工规则**。

---

# 一、整体流程图（End-to-End）

> **核心原则**：
>
> * ✅ 数值计算、指标加工、权重求解 → **量化引擎**
> * ✅ 状态判断、策略理解、解释输出 → **LLM**
> * ❌ LLM 不算权重

---

## ① 总流程图（ASCII）

```
        ┌──────────────────────────────┐
        │      宏观原始数据(32)         │
        └──────────────┬───────────────┘
                       │
        ┌──────────────▼──────────────────────────┐
        │ 量化引擎：指标加工/特征工程              │
        │ zscore · 分位数 · 趋势                   │
        └──────────────┬──────────────────────────┘
                       │
        ┌──────────────▼──────────────────────────┐
        │ LLM：宏观状态识别 S1~S8                  │
        └──────────────┬──────────────────────────┘
                       │
              ┌────────┴────────┐
              │                 │
        ┌─────▼──────────┐ ┌─────▼──────────┐
        │ 规则引擎：筛策略  │ │ LLM：直接选策略  │
        │ enable/disable  │ │ 排序/置信度      │
        └─────┬──────────┘ └─────┬──────────┘
              │                 │
              └────────┬────────┘
                       │
        ┌──────────────▼──────────────────────────┐
        │ 合并器：Rule硬门槛 + LLM优先级           │
        └──────────────┬──────────────────────────┘
                       │
        ┌──────────────▼─────────────────────────────────────────┐
        │ 量化引擎：Portfolio Engine（约束构建+优化求解+生成调仓） │
        └──────────────┬─────────────────────────────────────────┘
                       │
        ┌──────────────▼──────────────────────────┐
        │ LLM：合规解释 + 客户叙事                 │
        └─────────────────────────────────────────┘
```

---

## ② 用一句话“读懂”这张图（给老板/评审用）

> **量化引擎负责“算清楚”，LLM 负责“想明白 + 讲清楚”**
>
> * 状态怎么判 → LLM
> * 策略用哪些 → 规则 + LLM 并行
> * 权重怎么给 → 量化引擎
> * 为什么这么配 → LLM

---

# 二、策略池筛选器（放大图，核心差异点）

你特别强调的这一点非常专业，这里**单独拆一张图**。

---

## ②-1 策略池筛选器并行结构（Rule vs LLM）

```
                ┌───────────────────────────────────────┐
                │ 输入：宏观状态 Sx + 特征方向            │
                │ (GROWTH/INFL/LIQ/CREDIT/ERP/IV...)     │
                └───────────────────┬───────────────────┘
                                    │
                ┌──────────────────┴──────────────────┐
                ▼                                     ▼
    ┌───────────────────────────┐   ┌───────────────────────────┐
    │ 路由器 A：规则选策略        │   │ 路由器 B：LLM 直接选策略    │
    │ (Rule-based Router)       │   │ (LLM Router)              │
    │ · 触发/禁用条件             │   │ · 基于语义与经验选择与排序   │
    │ · 硬门槛：能/不能用          │   │ · 软增强：优先级/置信度/理由 │
    └─────────────┬─────────────┘   └─────────────┬─────────────┘
                  │                               │
                  │ rule_candidates               │ llm_candidates
                  │ (enable/disable)              │ (rank/confidence)
                  └───────────────┬───────────────┘
                                  │
                                  ▼
                ┌───────────────────────────────────────┐
                │ 合并器：Policy / Router Merger          │
                │ · Rule 做 Hard Gate：禁止的策略不能被启用 │
                │ · LLM 做 Soft Rank：对允许策略排序与解释  │
                └───────────────────┬───────────────────┘
                                    ▼
                ┌───────────────────────────────────────┐
                │ 输出：final_strategy_list               │
                │ enable/disable + priority + rationale   │
                └───────────────────────────────────────┘
```

> **最关键的设计点**  
> ✅ 规则负责“合规与稳定的硬门槛”  
> ✅ LLM 负责“覆盖规则盲区 + 给出优先级与可解释理由”  
> → 合并器确保不会出现“LLM 选了一个规则禁用策略”的事故。

---

## ②-2 两种策略筛选方式的**职责边界表**

| 维度      | 规则选策略（Rule-based） | LLM 选策略（LLM-based） |
| ------- | ----------------- | ------------------ |
| 核心目标    | **稳定、可控、可审计**     | **补盲区、处理复杂语义**     |
| 输入      | 宏观状态 + 特征阈值       | 宏观状态 + 特征方向        |
| 输出      | Enable / Disable  | 策略排序 / 置信度         |
| 优点      | 不发散、合规友好          | 适应结构变化、政策语境        |
| 缺点      | 覆盖有限、规则僵硬         | 可能发散               |
| 在系统中的地位 | **硬约束（底座）**       | **软增强（overlay）**   |

> **工程推荐做法（你这套体系最优解）**
> 👉 **Rule-based 决定“能不能用”**
> 👉 **LLM 决定“优先用哪个”**

---

# 三、Decision / Execution / Explanation 三段在图中的精确落位

- Decision：给“建议/偏好/排序”（soft decision）
- Execution：给“最终启用策略清单”（hard decision，可审计、可复现）

```
┌─────────────────────────────────────────────────────────┐
│ Decision（LLM）                                          │
│ - 输入：macro_features（方向/分位数/趋势）                │
│ - 输出：                                                  │
│   1) macro_state: S1~S8（含证据字段）                      │
│   2) strategy_intent: 策略意图（例如：偏趋势/偏估值/偏防守） │
│   3) llm_candidates: 策略候选 + 排序 + 置信度 + 理由        │
└───────────────┬─────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────┐
│  Execution（量化引擎：Portfolio Engine）                  │
│  - 输入：macro_state + final_strategy_list + μ/Σ + 约束库   │
│  - 内部一步到位：                                          │
│     1) 约束构建（bands/σ_cap/上下限/风控门槛）             │
│     2) 优化求解（MVO / 风险预算 / 再平衡最小改动）         │
│     3) 生成调仓建议（trade list / drift / 成本估计）        │
│  - 输出：weights + trades + risk_metrics                 │
└───────────────┬─────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────┐
│  Explanation + Client Narrative（LLM）                    │
│  - 输入：macro_state + 使用的策略 + weights/trades/风控指标  │
│  - 输出：合规解释（为什么）+ 客户可懂叙事（怎么做）           │
└─────────────────────────────────────────────────────────┘

```

> llm_candidates：LLM 建议的候选与排序（含理由、证据）  
> final_strategy_list：最终启用策略（含 rule gate 的结果、合并逻辑）
---

# 四、一句总结

> **这不是“LLM 配资产”，而是：**
> **LLM 负责判断世界处在什么状态，量化引擎负责在这个状态下给出最优解。**

---

