先讲**是什么**，再讲**数据与流程**，最后讲**为什么这样做更稳、更准、更可控**。

---

## Slide 1｜MVO 是什么：把“收益-风险权衡”写成可求解的数学问题

**一句话**：MVO（均值-方差优化）用“期望收益 μ + 风险协方差 Σ”来求一组最优权重 w，实现收益与风险的最优权衡。

* **输入**：

  * 期望收益向量 **μ**（4 资产年化收益）
  * 协方差矩阵 **Σ**（4×4 年化协方差）
  * 风险厌恶系数 **λ**（C1–C5 映射）
  * 约束（现金下限/风险资产上限/波动率上限/收益下限等）
* **输出**：四大类权重 **w = [w_cash,w_bond,w_equity,w_commodity]** + 风险收益指标（exp_return / ann_vol / sharpe 等）
* **定位**：作为 **SAA（战略资产配置）基线引擎**，可解释、可审计、可复现。

> 建议配图：一个“输入（μ、Σ、λ、约束）→ 求解器 → 输出权重（cash:10, bond:40, equity:45, commodity:5）”的盒子图。

---

## Slide 2｜理论支撑：经典效用最大化

****  
$$
U(w)= w^\top \mu - \frac{1}{2}\lambda, w^\top \Sigma w
$$

* 左边：组合效用 **U(w)**（越大越好）
* 第一项：**收益项**（期望收益越高越好）
* 第二项：**风险惩罚**（风险越大惩罚越大）
* **λ 的直觉**：

  * λ 大（C1）→ 更怕波动 → 权重偏向现金/债
  * λ 小（C5）→ 更追求收益 → 权重偏向权益/商品


---


## Slide 3｜需要什么数据：只要 3 件“模型输入级数据”（μ / Σ / rf）

**最小必需数据（模型层）**

### 1. **μ：四大类年化期望收益**（长窗/近窗各一套）
| 资产 | 期望收益 | 数据来源 |
|------|---------|---------|
| CASH | 2.44% | SHIBOR 1周利率（2013-2025，月频，均值×12） |
| BOND | 4.00% | 10年期国债收益率（2013-2025，月频，均值×12） |
| EQUITY | 13.02% | 沪深300ETF/510300（2013-2025，月频，均值×12） |
| COMMODITY | 7.79% | 商品综合：黄金70%+工业30%（2013-2025，月频，均值×12） |

### 2. **Σ：四大类年化协方差矩阵**（同窗口、同频率）

资产顺序: CASH, BOND, EQUITY, COMMODITY
```
  0.000010    0.000003    0.000091   -0.000085
  0.000003    0.000422   -0.000985   -0.000024
  0.000091   -0.000985    0.068279   -0.000274
 -0.000085   -0.000024   -0.000274    0.009452
```

### 3. **rf：无风险利率**（用于夏普/超额收益口径统一）

`rf = 1.4%`。0.014 = 截至 2026 年 1 月末、过去 12 个月的「中债 1 年期国债收益率」月均值的平均，再写成小数并保留 4 位小数。


---

# 2. 数据格式 / 从哪儿获取 / 怎么处理

---

## Slide 4｜数据从哪儿获取

**EQUITY（权益）**

* 沪深 300 ETF：510300

**COMMODITY（商品）**

* 黄金：黄金 ETF（518880）
* 工业商品：南华商品指数 NHCI
* 合成：(r_{cmd}=0.7r_{gold}+0.3r_{nhci})

**CASH（现金）**

* SHIBOR 1W（权威、历史长、可用）

**BOND（债券）**

* 10Y 国债收益率（中长端基准、历史长）
* 月收益近似：(r_{bond,m}=y_m/12 - D\Delta y_m,\ D=7)

### 时间范围
- 窗口：如 2013–2025（月频 150 个月）+ 近 3 年窗口（36 个月）
- 频率：全部月频（避免混频导致 Σ 不可比）

---

## Slide 5｜怎么处理：从日频到“可用于 MVO 的月收益序列”

**流水线（建议固定为 5 步）**

1. **清洗**：缺失值、异常点、重复日期
2. **对齐交易日**：统一日历（交易日/自然日规则）
3. **降频到月**：月末收盘 / 月均（按资产定义）
4. **生成月收益**：

   * 价格类：(r_t = px_t/px_{t-1}-1)
   * 利率类：按规则转月收益（cash/bond）
5. **年化统计**：

   * (\mu_{ann}=\text{mean}(r_m)\times 12)
   * (\Sigma_{ann}=\text{cov}(r_m)\times 12)

### CASH (SHIBOR) 计算验证
SHIBOR 1周月度收益计算示例:
- 日度SHIBOR 1W利率: 约1.7%（年化，百分比形式）
- 月度平均利率: rate_m = mean(daily_rates) ≈ 1.7%
- 月度收益: r_cash,m = (1.7 / 100) / 12 ≈ 0.00142 (0.142%)

**原始数据**
```csv
date,px,ticker,source
2025-12-26,1.448,SHIBOR_1W,akshare
2025-12-29,1.558,SHIBOR_1W,akshare
2025-12-30,1.589,SHIBOR_1W,akshare
2025-12-31,1.956,SHIBOR_1W,akshare
```
**产物**
```csv
date,cash_cn_shibor_1w
2025-11-30,0.001211625
2025-12-31,0.0012185181
```

---

# 3. LLM 用 MVO 的处理逻辑

## Slide 6｜LLM 在这里做什么：“编排 + 解释”



* **LLM 输入**

  1. 固定资产集合与顺序（4 类）
  2. 客户画像（life_stage / risk_level / need）
  3. 规则约束（cash_min / risk_asset_max / sigma_cap / return_floor）
  4. 市场数据摘要（μ、Σ、rf、波动率、相关性）
* **LLM 输出**

  * 约束确认清单（逐条“满足/不满足”）
  * 求解任务描述（给引擎/代码的结构化参数）
  * 解释话术（投顾版/领导版/合规版）

> 把模型需要的关键信息**一次性注入**，并固定结构。

---

## Slide 7｜“三段式”落地：Decision / Execution / Explanation

**Decision（LLM）**：把客户画像映射为“可计算的规则参数”

* 输出：cash_min、risk_asset_max、sigma_cap、return_floor、λ（或由风险等级表查）

**Execution（量化引擎）**：调用凸优化器求解 MVO

* 输入：μ、Σ、λ、约束
* 输出：w + exp_return + ann_vol + sharpe + 约束命中情况

**Explanation（LLM）**：把结果翻译成可用语言

* 为什么这么配：收益来源、分散化、风险控制点
* 给客户的版本：一句话结论 + 三条理由 + 风险提示

---

# 4. 对齐条件概率空间

## Slide 8｜解决什么问题：把“LLM 不稳定”变成“可控工程问题”

**核心矛盾**：LLM 擅长语言与归纳，但不擅长在缺少结构数据时稳定输出“数值最优解”。
**我们的解法**：先做“逆向工程 + 结构化注入”，再让模型输出。

* **逆向工程角色**：明确它是“投顾决策专家”，输出必须遵循约束
* **准备经济数据与格式**：把原始数据加工成 μ/Σ/rf（模型最需要的统计摘要）
* **固定结构与顺序**：把资产集合与顺序写死，减少歧义空间
* **结果可审计**：同输入同输出，支持回放与追责

> 不是让 LLM “自由发挥”，而是把它放进**结构化、可约束的条件空间**里工作。

---

## Slide 9｜为什么“对齐条件概率空间”会显著更好

**直觉表达**：

* 模型生成的质量取决于：它看到的“条件”是否充分、是否结构化、是否无歧义
* 你给它越清晰的条件（资产顺序、约束、μ/Σ、rf、窗口口径），它越容易输出稳定、合规、可复现的结果

**这套方法带来的直接收益**

* 幻觉少（因为关键数字都给了）
* 结果稳（结构固定、顺序固定）
* 易治理（规则参数可版本化）
* 易扩展（未来加 BL/TAA 层也沿用同一数据接口）

---
